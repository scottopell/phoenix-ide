# Patch Tool - Executive Summary

## Requirements Summary

The patch tool enables precise file editing through four operations: replace (substitute unique text), append_eof, prepend_bof, and overwrite (creates files). Replace operations require oldText to match exactly once, preventing ambiguous edits. Multiple patches per call are applied atomically against original content—if any fails, the file remains unchanged. Clipboards enable cut/copy/paste workflows that persist across calls, reducing transcription errors when moving code. Reindentation adjusts whitespace when moving code between indentation levels. Fuzzy matching recovers from minor whitespace differences in LLM-generated patches. Autogenerated files trigger warnings but patches apply anyway.

## Technical Summary

Implemented as a Tool trait with schema for path and patches array. Each patch specifies operation, optional oldText/newText, optional clipboard names, and optional reindent config. EditBuffer tracks all edits against original content for atomic application. Fuzzy matching tries: exact match, dedent adjustment, Go token normalization, line trimming. Clipboards stored in HashMap on PatchTool struct, persisting within conversation. Reindentation strips then adds prefixes line-by-line, failing if strip prefix not present. Unified diff generated for UI display.

## Status Summary

| Requirement | Status | Notes |
|-------------|--------|-------|
| **REQ-PATCH-001:** File Operations | ✅ Complete | replace, append_eof, prepend_bof, overwrite |
| **REQ-PATCH-002:** Multiple Patches Per Call | ✅ Complete | Atomic application with edit buffer |
| **REQ-PATCH-003:** Clipboard Operations | ✅ Complete | toClipboard/fromClipboard with persistence |
| **REQ-PATCH-004:** Indentation Adjustment | ✅ Complete | strip/add prefixes line-by-line |
| **REQ-PATCH-005:** Fuzzy Matching Recovery | ✅ Complete | Dedent matching, trimmed line match |
| **REQ-PATCH-006:** Tool Schema | ✅ Complete | Full schema with all options |
| **REQ-PATCH-007:** Output and Display | ✅ Complete | Unified diff, autogenerated warnings |
| **REQ-PATCH-008:** Size Limits | ✅ Complete | 60KB input limit enforced |
| **REQ-PATCH-009:** Mode-Based Availability | ❌ Not Started | Disabled in Restricted mode |

**Progress:** 8 of 9 complete
